<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta id="viewport-meta" name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>í•œì™„ê¸° ì‹¤ì „í¸ ì „ëµ ìˆ˜ë¦½ (Dark Mode & Flip)</title>
    <style>
        /* ğŸ¨ [ë‹¤í¬ëª¨ë“œ ë³€ìˆ˜ ì„¤ì •] */
        :root {
            --bg-color: #eef2f7;
            --box-bg: #ffffff;
            --text-main: #0f172a;
            --text-sub: #64748b;
            --border-color: #e2e8f0;
            --timestamp-bg: #f8fafc;
            --timestamp-item: #ffffff;
            --book-bg: #e2e8f0;
            --theme-btn-bg: #ffffff;
            --theme-btn-text: #0f172a;
            /* íƒ€ì´ë¨¸ ê¸°ë³¸ ìƒ‰ìƒ ë³€ìˆ˜ (ìŠ¤í¬ë¦½íŠ¸ì—ì„œ ë³€ê²½ë¨) */
            --timer-color: #10b981; 
            --timer-glow: rgba(16, 185, 129, 0.2);
        }

        body.dark-mode {
            --bg-color: #121212;
            --box-bg: #1e293b;
            --text-main: #f1f5f9;
            --text-sub: #94a3b8;
            --border-color: #334155;
            --timestamp-bg: #0f172a;
            --timestamp-item: #1e293b;
            --book-bg: #334155;
            --theme-btn-bg: #334155;
            --theme-btn-text: #f1f5f9;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; 
            background: var(--bg-color);
            color: var(--text-main); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column;
            align-items: center; 
            padding: 20px;
            touch-action: manipulation; 
            -webkit-text-size-adjust: 100%;
            transition: background-color 0.4s, color 0.4s;
        }
        
        .container { 
            max-width: 600px; 
            width: 100%; 
            text-align: center; 
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ğŸŒ™ [ë‹¤í¬ëª¨ë“œ í† ê¸€ ë²„íŠ¼] */
        .theme-toggle {
            position: absolute;
            top: -10px;
            right: 0;
            background: var(--theme-btn-bg);
            color: var(--theme-btn-text);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            transition: all 0.3s;
            z-index: 1000;
        }
        .theme-toggle:hover { transform: translateY(-2px); }

        /* [ë¡œê³ ] */
        .main-logo {
            width: 220px;
            height: auto;
            margin-top: 40px;
            margin-bottom: 20px;
            transition: all 0.4s;
            mix-blend-mode: multiply; 
        }
        body.dark-mode .main-logo {
            filter: invert(1) hue-rotate(180deg); 
            mix-blend-mode: screen; 
        }

        /* ğŸ“– [3D ì±…ì¥ ë„˜ê¸°ê¸° (Flip) ì»¨í…Œì´ë„ˆ] */
        .scene {
            width: 100%;
            perspective: 1200px;
            margin-bottom: 30px;
            display: block; 
        }
        
        .card {
            width: 100%;
            display: grid; 
            transition: transform 0.8s cubic-bezier(0.4, 0.2, 0.2, 1);
            transform-style: preserve-3d;
        }
        
        .card.is-flipped {
            transform: rotateY(-180deg);
        }

        .card__face {
            grid-area: 1 / 1; 
            backface-visibility: hidden;
            background: var(--box-bg); 
            border-radius: 20px; 
            padding: 40px; 
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.10); 
            border: 1px solid var(--border-color); 
            display: flex;
            flex-direction: column;
            transition: background-color 0.4s, border-color 0.4s;
        }

        .card__face--front { transform: rotateY(0deg); }
        .card__face--back { transform: rotateY(180deg); }

        h1 { 
            color: var(--text-main); 
            margin-bottom: 30px; 
            font-size: 28px; 
            font-weight: bold; 
        }

        /* [ë²„íŠ¼ ê³µí†µ ìŠ¤íƒ€ì¼] */
        .btn { 
            width: 100%; padding: 18px; font-size: 18px; font-weight: 600; 
            border: 2px solid transparent; 
            border-radius: 12px; cursor: pointer; 
            transition: all 0.2s ease; display: flex; align-items: center; 
            justify-content: center; gap: 12px; text-decoration: none; 
            margin-bottom: 15px; touch-action: manipulation;
        }
        .btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(0,0,0,0.15); filter: brightness(1.1); }
        .btn:active { transform: translateY(0); filter: brightness(1.0); }

        /* ë¼ì´íŠ¸ëª¨ë“œ ë²„íŠ¼ ìƒ‰ìƒ */
        .btn-purple { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) border-box; color: white; }
        .btn-pink { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%) border-box; color: white; }
        .btn-mint { background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%) border-box; color: white; }

        /* ë‹¤í¬ëª¨ë“œ ë²„íŠ¼ ìƒ‰ìƒ */
        body.dark-mode .btn-purple {
            background: linear-gradient(var(--box-bg), var(--box-bg)) padding-box, linear-gradient(135deg, #667eea 0%, #764ba2 100%) border-box;
            color: #b592ff; 
        }
        body.dark-mode .btn-pink {
            background: linear-gradient(var(--box-bg), var(--box-bg)) padding-box, linear-gradient(135deg, #f093fb 0%, #f5576c 100%) border-box;
            color: #fca5bb; 
        }
        body.dark-mode .btn-mint {
            background: linear-gradient(var(--box-bg), var(--box-bg)) padding-box, linear-gradient(135deg, #11998e 0%, #38ef7d 100%) border-box;
            color: #6ee7b7; 
        }

        /* [íƒ€ì´ë¨¸ ì¡°ì‘ ë²„íŠ¼] */
        .btn-start { background: #28a745; color: white; flex: 1; margin-bottom: 0; }
        .btn-pause { background: #ffc107; color: #333; flex: 1; margin-bottom: 0; }
        .btn-reset { background: #dc3545; color: white; flex: 1; margin-bottom: 0; }
        .btn-record { background: #17a2b8; color: white; flex: 1; margin-bottom: 0; }
        .btn-record:disabled { background: var(--border-color); color: var(--text-sub); cursor: not-allowed; transform: none; box-shadow: none; filter: none; }
        .btn-back { background: var(--border-color); color: var(--text-main); margin-top: 20px; }

        /* ğŸ“š [ì±… í‘œì§€ ë²„íŠ¼ ì˜ì—­] */
        .book-section-title { margin-top: 25px; margin-bottom: 10px; font-size: 14px; color: var(--text-sub); font-weight: bold; }
        .book-container { display: flex; justify-content: space-between; gap: 12px; width: 100%; }
        .book-link {
            flex: 1; aspect-ratio: 2 / 3; border-radius: 8px; background-color: var(--book-bg);
            color: var(--text-main); text-decoration: none; display: flex; align-items: center;
            justify-content: center; font-size: 13px; font-weight: 600; text-align: center;
            line-height: 1.4; box-shadow: 0 4px 8px rgba(0,0,0,0.1); transition: transform 0.3s, box-shadow 0.3s;
            overflow: hidden; position: relative;
        }
        .book-link:hover { transform: translateY(-5px); box-shadow: 0 8px 16px rgba(0,0,0,0.2); }
        .book-link img { position: absolute; width: 100%; height: 100%; object-fit: cover; }

        /* ì´ë¯¸ì§€ ì»¨í…Œì´ë„ˆ */
        .image-container img { width: 100%; border-radius: 12px; margin-bottom: 15px; }

        /* â±ï¸ [ì›í˜• ìˆ¨ì‰¬ëŠ” íƒ€ì´ë¨¸ ìŠ¤íƒ€ì¼] */
        .timer-container {
            position: relative;
            width: 260px;
            height: 260px;
            margin: 20px auto 30px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* ì‹œê°„ì— ë”°ë¥¸ ìƒ‰ìƒ ë³€í™”ë¥¼ ìœ„í•œ í…Œë§ˆ í´ë˜ìŠ¤ */
        .timer-container.theme-mint { --timer-color: #10b981; --timer-glow: rgba(16, 185, 129, 0.25); }
        .timer-container.theme-yellow { --timer-color: #f59e0b; --timer-glow: rgba(245, 158, 11, 0.25); }
        .timer-container.theme-red { --timer-color: #ef4444; --timer-glow: rgba(239, 68, 68, 0.3); }

        .breathing-circle {
            position: absolute;
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 4px solid var(--border-color); /* ê¸°ë³¸ í…Œë‘ë¦¬ */
            background: transparent;
            transition: border-color 0.5s ease; 
            z-index: 0;
        }

        .breathing-circle.active {
            border-color: var(--timer-color); /* ì‹œê°„ì— ë§ì¶° ë³€í•˜ëŠ” ìƒ‰ìƒ */
            animation: breathe-circle 3s ease-in-out infinite;
        }

        @keyframes breathe-circle {
            0% { transform: scale(1); box-shadow: 0 0 0 0 transparent; opacity: 1; }
            50% { transform: scale(1.05); box-shadow: 0 0 25px 10px var(--timer-glow); opacity: 0.8; }
            100% { transform: scale(1); box-shadow: 0 0 0 0 transparent; opacity: 1; }
        }

        .timer-display {
            position: relative;
            z-index: 1; 
            font-size: 58px;
            font-weight: bold;
            color: var(--text-main); /* ê¸°ë³¸ ê¸€ììƒ‰ (íƒ€ì´ë¨¸ ì‹œì‘ ì „) */
            font-family: 'Courier New', monospace;
            text-shadow: 2px 2px 4px rgba(15, 23, 42, 0.08);
            transition: color 1s ease;
        }
        
        /* íƒ€ì´ë¨¸ ì‘ë™ ì¤‘ì—ë§Œ ê¸€ì ìƒ‰ìƒë„ ë™ê¸°í™” */
        .timer-container.active-theme .timer-display {
            color: var(--timer-color);
        }

        .timer-label { color: var(--text-sub); font-size: 18px; margin-bottom: 10px; }
        .timer-hint { color: var(--text-sub); font-size: 13px; margin-bottom: 5px; }
        .timer-buttons { display: flex; gap: 10px; margin-bottom: 10px; }
        .timer-buttons .btn { padding: 14px; font-size: 16px; margin-bottom: 0;}

        .timestamp-section { margin-top: 15px; padding: 15px; background: var(--timestamp-bg); border-radius: 12px; border: 1px solid var(--border-color); transition: background-color 0.4s; }
        .timestamp-title { font-size: 16px; color: var(--text-sub); margin-bottom: 10px; }
        .timestamp-list { display: flex; flex-direction: column; gap: 8px; }
        .timestamp-item { display: flex; justify-content: space-between; align-items: center; padding: 10px 15px; background: var(--timestamp-item); border-radius: 8px; border-left: 4px solid #17a2b8; box-shadow: 0 2px 5px rgba(0,0,0,0.05); transition: background-color 0.4s; }
        .timestamp-item.empty { color: var(--text-sub); border-left-color: var(--border-color); justify-content: center; }
        .timestamp-number { font-weight: 600; color: #17a2b8; }
        .timestamp-time { font-family: 'Courier New', monospace; font-size: 18px; font-weight: bold; color: var(--text-main); }
        .record-count { font-size: 14px; color: var(--text-sub); margin-top: 10px; }
        .emoji { font-size: 24px; }

        /* í‘¸í„° */
        .ig-footer { padding: 0 12px 20px; width: 100%; margin-top: 20px;}
        .ig-footer__sns { display: flex; gap: 10px; align-items: center; justify-content: center; margin-bottom: 15px; }
        .ig-sns { width: 40px; height: 40px; display: inline-flex; align-items: center; justify-content: center; border-radius: 999px; text-decoration: none; background: var(--box-bg); border: 1px solid var(--border-color); transition: transform .12s ease, box-shadow .12s ease; color: var(--text-sub); }
        .ig-sns:hover { transform: translateY(-2px); box-shadow: 0 6px 18px rgba(0, 0, 0, .1); }
        .ig-sns svg { width: 20px; height: 20px; fill: currentColor; stroke: currentColor; }
        .ig-sns--instagram:hover { color: #E1306C; border-color: currentColor; }
        .ig-sns--naver:hover { color: #03C75A; border-color: #03C75A; }
        .ig-footer__info { margin: 12px 0 10px; display: grid; gap: 6px; color: var(--text-sub); font-size: 12.5px; line-height: 1.35; text-align: center; }
        .ig-footer__info p { margin: 0; }
        .ig-footer__info a { color: inherit; text-decoration: underline; text-underline-offset: 2px; }
        .ig-footer__copyright { margin: 0; font-size: 12.5px; color: var(--text-sub); text-align: center; }

        @media (max-width: 480px) {
            .card__face { padding: 25px; }
            h1 { font-size: 22px; }
            .timer-container { width: 240px; height: 240px; }
            .timer-display { font-size: 48px; }
            .timer-buttons { flex-wrap: wrap; }
            .timer-buttons .btn { flex: 1 1 45%; }
            .book-link { font-size: 11px; }
        }
    </style>
</head>
<body>
    <div class="container">
        
        <button class="theme-toggle" onclick="toggleTheme()" id="themeBtn">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>

        <img src="https://cdn.imweb.me/thumbnail/20251022/5f0f79023d456.png" alt="INTEGRATE" class="main-logo">

        <div class="scene" id="scene-container">
            <div class="card" id="main-card">
                
                <div class="card__face card__face--front">
                    <h1>í•œì™„ê¸° ì‹¤ì „í¸</h1>
                    <a href="https://integrate.kr/column/?q=YToxOntzOjEyOiJrZXl3b3JkX3R5cGUiO3M6MzoiYWxsIjt9&bmode=view&idx=170013700&t=board" target="_blank" class="btn btn-purple">
                        íƒ€ì„ë¼ì¸ ê°€ì´ë“œ
                    </a>
                    <button class="btn btn-pink" onclick="showScreen('image')">
                        ë‹¨ê³„ë³„ ì „ëµ ìˆ˜ë¦½
                    </button>
                    <button class="btn btn-mint" onclick="showScreen('timer')">
                        <span class="emoji">â±ï¸</span>
                        100ë¶„ íƒ€ì´ë¨¸
                    </button>

                    <p class="book-section-title">ì¶”ì²œ êµì¬ (í´ë¦­ ì‹œ ì´ë™)</p>
                    <div class="book-container">
                        <a href="https://integrate.kr/" target="_blank" class="book-link"><span>í•œì™„ìˆ˜<br>ì‹œë¦¬ì¦ˆ</span></a>
                        <a href="https://integrate.kr/" target="_blank" class="book-link"><span>í•œì™„ê¸°<br>ê¸°ì¶œí¸</span></a>
                        <a href="https://integrate.kr/" target="_blank" class="book-link"><span>í•œì™„ê¸°<br>ì‹¤ì „í¸</span></a>
                    </div>
                </div>

                <div class="card__face card__face--back">
                    
                    <div id="view-timer" style="display: none;">
                        <h1>â±ï¸ 100ë¶„ íƒ€ì´ë¨¸</h1>
                        <p class="timer-hint">ğŸ’¡ ì‹œí—˜ ì‹œì‘ ì „ì— ë¨¼ì € [ì‹œì‘], [ê¸°ë¡] ë²„íŠ¼ì„ ëˆŒëŸ¬ì„œ í…ŒìŠ¤íŠ¸í•´ë³´ì„¸ìš”</p>
                        <p class="timer-label">ê²½ê³¼ ì‹œê°„</p>
                        
                        <div class="timer-container theme-mint" id="timer-container">
                            <div class="breathing-circle" id="breathing-circle"></div>
                            <div class="timer-display" id="timer-display">00:00</div>
                        </div>
                        
                        <div class="timer-buttons">
                            <button class="btn btn-start" id="start-btn" onclick="toggleTimer()">â–¶ ì‹œì‘</button>
                            <button class="btn btn-record" id="record-btn" onclick="recordTimestamp()">ğŸ“Œ ê¸°ë¡</button>
                            <button class="btn btn-reset" onclick="resetTimer()">â†º ë¦¬ì…‹</button>
                        </div>

                        <div class="timestamp-section">
                            <p class="timestamp-title">ğŸ“‹ ê¸°ë¡ëœ íƒ€ì„ìŠ¤íƒ¬í”„</p>
                            <div class="timestamp-list" id="timestamp-list">
                                <div class="timestamp-item empty">ê¸°ë¡ ì—†ìŒ</div>
                            </div>
                            <p class="record-count" id="record-count">ë‚¨ì€ ê¸°ë¡ íšŸìˆ˜: 4íšŒ</p>
                        </div>
                        
                        <button class="btn btn-back" onclick="goBackToMain()">â† ë’¤ë¡œ ê°€ê¸°</button>
                    </div>

                    <div id="view-image" style="display: none;">
                        <h1>ë‹¨ê³„ë³„ ì „ëµ ìˆ˜ë¦½</h1>
                        <div class="image-container">
                            <img src="ë‹¨ê³„ë³„_ì „ëµ.png" alt="ë‹¨ê³„ë³„ ì „ëµ">
                        </div>
                        <button class="btn btn-back" onclick="goBackToMain()">â† ë’¤ë¡œ ê°€ê¸°</button>
                    </div>

                </div>

            </div>
        </div>

        <footer class="ig-footer">
            <div class="ig-footer__sns">
                <a href="https://www.instagram.com/lhw_math/" target="_blank" class="ig-sns ig-sns--instagram" id="sns-insta">
                    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="5" ry="5" fill="none" stroke="currentColor" stroke-width="2"></rect><circle cx="12" cy="12" r="4" fill="none" stroke="currentColor" stroke-width="2"></circle><circle cx="17" cy="7" r="1.4" fill="currentColor"></circle></svg>
                </a>
                <a href="https://cafe.naver.com/pnmath" target="_blank" class="ig-sns ig-sns--naver" id="sns-naver">
                    <svg viewBox="0 0 24 24"><rect x="3" y="3" width="18" height="18" rx="4" fill="none" stroke="currentColor" stroke-width="2"></rect><path d="M7.5 17.5V6.5h3.1l3.9 6.6V6.5h3v11h-3.1l-3.9-6.6v6.6h-3z" fill="currentColor"></path></svg>
                </a>
            </div>
            <div class="ig-footer__info">
                <p>ì£¼ì†Œ : ì„œìš¸íŠ¹ë³„ì‹œ ê°•ë‚¨êµ¬ ì„ ë¦‰ë¡œ 608 (ì‚¼ì„±ë™, ì„ ì§„ë¹Œë”© 6ì¸µ)</p>
                <p>ãˆœ ì¸í„°ê·¸ë ˆì´íŠ¸ | ëŒ€í‘œì´ì‚¬: ì´í•´ì›</p>
                <p>ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸: 401-87-02099</p>
                <p>ì´ë©”ì¼: <a href="mailto:info@integrate.kr">info@integrate.kr</a></p>
            </div>
            <p class="ig-footer__copyright">Copyright Â© 2025 ãˆœ ì¸í„°ê·¸ë ˆì´íŠ¸ All rights reserved.</p>
        </footer>
    </div>

    <script>
        // 1. ë‹¤í¬ëª¨ë“œ
        function toggleTheme() {
            const body = document.body;
            const themeBtn = document.getElementById('themeBtn');
            body.classList.toggle('dark-mode');
            if (body.classList.contains('dark-mode')) {
                themeBtn.textContent = 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ';
            } else {
                themeBtn.textContent = 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
            }
        }

        // 2. ì¤Œ ì œì–´
        function setZoomEnabled(enabled) {
            const viewport = document.getElementById('viewport-meta');
            if (enabled) {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes');
            } else {
                viewport.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no');
            }
        }

        // 3. ë³€ìˆ˜ ë° í™”ë©´/íƒ€ì´ë¨¸ ë¡œì§
        const maxTime = 100 * 60; // 100ë¶„
        let timerInterval = null;
        let isRunning = false;
        let startTime = null;
        let pausedElapsed = 0;
        let timerEnded = false;

        const maxRecords = 4;
        let timestamps = [];
        const recordLabels = ['1íšŒë… ë‹¨ê³„', '2íšŒë… ë‹¨ê³„', 'ê²€í† /ë§ˆë¬´ë¦¬', 'í’€ì´ ì¢…ë£Œ'];
        let currentScreen = 'main';

        // ğŸ”„ í™”ë©´ ì „í™˜ (Flip) ë¡œì§ ê°œì„ 
        function showScreen(screen) {
            currentScreen = screen;
            setZoomEnabled(screen === 'image');

            const mainCard = document.getElementById('main-card');
            const viewTimer = document.getElementById('view-timer');
            const viewImage = document.getElementById('view-image');

            if (screen === 'main') {
                // ë©”ì¸ìœ¼ë¡œ ëŒì•„ê°ˆ ë• ë¨¼ì € ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ
                mainCard.classList.remove('is-flipped');
                
                // ë’¤ì§‘íˆëŠ” ì• ë‹ˆë©”ì´ì…˜ ë„ì¤‘ì— ë†’ì´ê°€ í™• ì¤„ì–´ë“¤ì§€ ì•Šë„ë¡ ì‹œê°„ì°¨ë¥¼ ë‘ 
                setTimeout(() => {
                    if (currentScreen === 'main') {
                        viewTimer.style.display = 'none';
                        viewImage.style.display = 'none';
                    }
                }, 400); // ì• ë‹ˆë©”ì´ì…˜(0.8s)ì˜ ì ˆë°˜ ëŒ€ê¸°
            } else {
                // íƒ€ì´ë¨¸ë‚˜ ì´ë¯¸ì§€ë¡œ ê°ˆ ë• ì•Œë§ì€ ë·°ë¥¼ ë¨¼ì € ì¼œê³  ì¹´ë“œë¥¼ ë’¤ì§‘ìŒ
                if (screen === 'timer') {
                    viewImage.style.display = 'none';
                    viewTimer.style.display = 'block';
                } else if (screen === 'image') {
                    viewTimer.style.display = 'none';
                    viewImage.style.display = 'block';
                }
                mainCard.classList.add('is-flipped');
            }

            if (screen !== 'main') {
                history.pushState({ screen: screen }, '', '');
            }
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return mins.toString().padStart(2, '0') + ':' + secs.toString().padStart(2, '0');
        }

        function getElapsedTime() {
            if (!isRunning || !startTime) return pausedElapsed;
            const now = Date.now();
            const elapsed = pausedElapsed + Math.floor((now - startTime) / 1000);
            return Math.min(elapsed, maxTime);
        }

        // ğŸŒˆ ì‹œê°„ì— ë”°ë¥¸ í…Œë§ˆ(ìƒ‰ìƒ) ë³€ê²½
        function updateTimerColor(elapsedSeconds) {
            const container = document.getElementById('timer-container');
            container.classList.remove('theme-mint', 'theme-yellow', 'theme-red');

            if (elapsedSeconds > 5700) { 
                container.classList.add('theme-red');
            } else if (elapsedSeconds > 3000) { 
                container.classList.add('theme-yellow');
            } else {
                container.classList.add('theme-mint');
            }
        }

        function updateDisplay() {
            const elapsed = getElapsedTime();
            const displayObj = document.getElementById('timer-display');
            displayObj.textContent = formatTime(elapsed);
            
            updateTimerColor(elapsed);

            // ì¢…ë£Œ ì²´í¬
            if (elapsed >= maxTime && isRunning && !timerEnded) {
                timerEnded = true;
                clearInterval(timerInterval);
                pausedElapsed = maxTime;
                isRunning = false;
                
                document.getElementById('breathing-circle').classList.remove('active');
                document.getElementById('timer-container').classList.remove('active-theme');
                
                const btn = document.getElementById('start-btn');
                btn.textContent = 'â–¶ ì‹œì‘';
                btn.className = 'btn btn-start'; 
                alert('ğŸ”” ì‹œí—˜ì‹œê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        }

        function toggleTimer() {
            const btn = document.getElementById('start-btn');
            const circle = document.getElementById('breathing-circle');
            const container = document.getElementById('timer-container');

            if (isRunning) {
                // ì¼ì‹œì •ì§€
                clearInterval(timerInterval);
                pausedElapsed = getElapsedTime();
                startTime = null;
                isRunning = false;
                
                btn.textContent = 'â–¶ ì‹œì‘';
                btn.className = 'btn btn-start';
                
                circle.classList.remove('active');
                container.classList.remove('active-theme'); // ê¸€ììƒ‰ ì›ìƒë³µêµ¬

            } else {
                // ì‹œì‘
                if (getElapsedTime() < maxTime) {
                    startTime = Date.now();
                    isRunning = true;
                    timerEnded = false;
                    
                    btn.textContent = 'â¸ ì¼ì‹œì •ì§€';
                    btn.className = 'btn btn-pause';
                    
                    circle.classList.add('active');
                    container.classList.add('active-theme'); // ê¸€ììƒ‰ë„ í…Œë§ˆìƒ‰ìœ¼ë¡œ ë³€ê²½

                    if (timerInterval) clearInterval(timerInterval);
                    timerInterval = setInterval(updateDisplay, 500);
                    updateDisplay();
                }
            }
        }

        function recordTimestamp() {
            if (timestamps.length >= maxRecords) {
                alert('ëª¨ë“  ë‹¨ê³„ê°€ ê¸°ë¡ë˜ì—ˆìŠµë‹ˆë‹¤.');
                return;
            }
            const elapsed = getElapsedTime();
            if (!isRunning && elapsed === 0) {
                alert('íƒ€ì´ë¨¸ë¥¼ ë¨¼ì € ì‹œì‘í•´ì£¼ì„¸ìš”.');
                return;
            }
            timestamps.push(elapsed);
            updateTimestampDisplay();
        }

        function updateTimestampDisplay() {
            const listElement = document.getElementById('timestamp-list');
            const countElement = document.getElementById('record-count');
            const recordBtn = document.getElementById('record-btn');
            
            if (timestamps.length === 0) {
                listElement.innerHTML = '<div class="timestamp-item empty">ê¸°ë¡ ì—†ìŒ</div>';
            } else {
                listElement.innerHTML = timestamps.map((time, index) => `
                    <div class="timestamp-item">
                        <span class="timestamp-number">${recordLabels[index]}</span>
                        <span class="timestamp-time">${formatTime(time)}</span>
                    </div>
                `).join('');
            }
            const remaining = maxRecords - timestamps.length;
            countElement.textContent = `ë‚¨ì€ ê¸°ë¡ íšŸìˆ˜: ${remaining}íšŒ`;
            if (remaining === 0) recordBtn.disabled = true;
            else recordBtn.disabled = false;
        }

        function resetTimer() {
            clearInterval(timerInterval);
            timerInterval = null;
            isRunning = false;
            startTime = null;
            pausedElapsed = 0;
            timerEnded = false;
            timestamps = [];
            
            document.getElementById('breathing-circle').classList.remove('active');
            document.getElementById('timer-container').classList.remove('active-theme');

            updateDisplay();
            updateTimestampDisplay();
            const btn = document.getElementById('start-btn');
            btn.textContent = 'â–¶ ì‹œì‘';
            btn.className = 'btn btn-start';
            document.getElementById('record-btn').disabled = false;
        }

        function goBackToMain() {
            if (currentScreen === 'timer') resetTimer();
            showScreen('main');
        }

        function handlePageResume() { if (isRunning) updateDisplay(); }
        document.addEventListener('visibilitychange', function() { if (!document.hidden) handlePageResume(); });
        window.addEventListener('focus', handlePageResume);
        window.addEventListener('pageshow', handlePageResume);
        window.addEventListener('popstate', function(e) { goBackToMain(); });
        history.replaceState({ screen: 'main' }, '', '');

        document.addEventListener("DOMContentLoaded", function() {
            const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
            if (isMobile) {
                const instaBtn = document.getElementById('sns-insta');
                if(instaBtn) {
                    instaBtn.removeAttribute("target");
                    instaBtn.href = "instagram://user?username=lhw_math";
                }
                const naverBtn = document.getElementById('sns-naver');
                if(naverBtn) {
                    naverBtn.removeAttribute("target");
                    naverBtn.href = "navercafe://cafe?cafeId=23380319";
                }
            }
        });
    </script>
</body>
</html>
